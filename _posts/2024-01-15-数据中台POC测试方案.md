---
layout:     post
title:      数据中台POC测试方案
subtitle:
date:       2024-01-15
author:     RC
header-img:
catalog: true
tags:
    - 数据中台
    - 数据底座
    - 流批计算
    - 大数据
    - 测试方案
---

### 测试背景

当前市场上数据中台供应商众多，但各家供应商在技术水平、行业经验、服务保障等方面存在差异。为了确保后续项目供应商选择的合理性与项目交付的标准性，公司决定组织多部门联合对市场上的数据中台供应商进行POC测试。

通过组合型测试的方式，选取不同组合中表现最好、最优的供应商，综合评估其技术实力和服务能力，为公司后续项目的供应商选择提供有力支撑。

> 组合测试的意思是数据中台本身和存算底座分离，分别由不同的厂商提供。因此，也需要一定时间来适配。
	 
本文结合实际测试方案简单地梳理了数据中台产品POC测试的过程和内容。

### 测试范围

数据中台的基本能力：数据标准、数据模型、数据集成、数据开发、调度管理、数据质量、元数据管理、数据服务、数据资产等。

数据中台的其他能力：平台性能、稳定性、安全性、兼容性、易用性、扩展性、系统管理等。

### 硬件环境

| 类别      | 内容描述 | 资源情况 | 数量
| ----------- | ----------- | ----------- | ----------- |
| 计算存储底座      | 部署计算存储生态的技术内容，比如：Hadoop、Hive、Spark、Flink等|24核CPU，64GB内存，100GB系统盘+100GB数据盘，千兆网卡，64位操作系统 | 6 (台) |
| 业务场景构造   | 部署前置数据库MySQL，构造业务数据 |16核CPU，32GB内存，2TB数据盘，千兆网卡，操作系统版本openEuler 22.03 LTS | 2 (台) | 

> 需要满足厂商的最小化配置部署系统资源要求，因此计算存储底座和业务系统应用需要保证系统节点的数量

> 云服务资源总体提供：CPU核 176，内存448GB，存储5TB

### 软件环境

- 操作系统：OpenEuler、其他（根据厂商需求进行调整）

- 数据库：星环、MySQL 8.0

### 测试内容

#### 产品选型依据

![1](https://i.postimg.cc/52LLKkV2/1.png)

围绕着数据采集、开发、治理到形成数据资产、提供数据应用的全链路场景，形成了以上数据中台产品应用架构。基于一个通用型数据中台应具备的基础能力，梳理了产品选型时需考量的功能模块、性能等内容，并根据项目真实需求筛选了数据中台的三个典型应用场景用于功能测试。

#### 测试功能评价规则说明

测试主要包含POC基础测试、POC场景测试两个部分，本次测试采用优、良、差评价方式，功能衔接流畅、使用便捷评为优；功能衔接不紧密评为良；功能难以使用评为差。

- POC基础测试包括：功能项测试、安全性测试、易用性测试三个部分

- POC场景测试包括：四个场景（一个可选）

- 其他可选评估：相关文档评估、功能加分项 

### 基础测试

#### 功能项测试、安全性测试、易用性测试

> 该部分与功能清单基本一致，不再赘述

### 场景测试

场景测试主要设计了4个场景进行实际应用场景和数据的测试，分别对应实时计算、离线计算、API接口共享交换和压力测试。

#### 排叫号系统-政务中心排叫号统计

##### 1.需求描述

需要统计排叫号系统中的排号数，叫号数，平均等候时间，按区县、街道、政务中心分类统计等指标，将当日中心办件数据同步到测试前置库，通过中台进行采集和加工，经过计算形成每日中心办件数据统计表，并对办件数据按区划、大厅、时间进行统计分析，并可对数据质量进行配置监控。具体场景如下：

- [ ] 在数据处理前进行数仓模型设计

- [ ] 实时同步源端业务数据到Flink进行计算

- [ ] 通过低代码方式配置源端、计算过程、目标端，生成FlinkSQL语句，并对生成的FlinkSQL语句进行语法预检，并能标记预检错误行数

- [ ] 对任务进行编辑后提交到Flink集群，展示算子执行计划图，对每一个算子进行运行状态监控，展示当前算子数据处理状态

- [ ] 监控实时作业运行状态，包括Flink集群JobManager状态和TaskManager状态

- [ ] 将数据计算结果输出到数据库进行存储，对汇总层、明细层数据量进行核实

- [ ] 对每日中心排叫号数据的质量进行监控

##### 2.评价规则

各指标符合大屏指标要求，数据及时更新，计算结果和源端数据一致，功能使用便捷，系统操作简单为优；能实现需求，功能衔接不紧密评为良；不能实现需求评为差。

#### 办件系统- 办件统计

##### 1.需求描述

需要统计办件系统中的办件总数，网办数，超时办结数，未办结等指标，将办件信息同步到测试前置库，通过中台进行采集和加工，经过计算形成每日办件数据统计表，并对办件数据按区划、时间进行统计分析，涉及数据表：

- 办件数据信息表

- 实施清单信息表

- 实施主体信息表

> 为了简化计算步骤，部分维表使用了加工后的表

###### 数据采集

- 初始化全量同步3张表的数据到贴源层，增加数仓相关字段【入库时间】、【入库后最后更新时间】、【删除标识】，与前置库数据比对一致；

- 进行源系统增量模拟，通过增量采集数据到贴源层（至少一张表用Flink CDC实现）；

- 完成增量数据合并到全量，与前置库数据比对一致。

###### 标准定义

- 命名标准，如：办件编号、事项名称、事项编码、办件状态的字段命名标准定义；

- 代码标准，如：事项类型、法人服务主题的代码取值标准定义。

###### 模型设计

对两张表分别做公共层数据模型设计，生成：

- 办件信息明细表

- 实施清单最新明细表

- 实施清单历史明细表

定义从贴源层到公共层的清洗转换规则，以实现后续业务需求，如：

- 引用标准中定义的命名标准和代码标准

- 对中心标识、中心名称的加密

- 对窗口标识、窗口名称的脱敏

- 将"实施清单信息表"的数据与"实施主体信息表"通过部门Id进行关联得到宽表数据，详细规则如下：

```html
实施清单信息表按照实施清单id（GuideId）分组后按主键id排序，取id最大值；取同步状态为"I"的，事项状态为"在用"的，行使方式为"依申请行使"的数据过滤，此规则得到的表为实施清单最新明细表。
```

```html
实施清单信息表按照省库事项id（EventId）分组后按主键id排序，取id最大值；行使方式为"依申请行使"的，省库事项id不为空值的数据过滤，此规则得到的表为实施清单历史明细表。
```

- 将"办件数据信息表"的数据与"实施清单最新明细表"、"实施清单历史明细表"通过事项编码、省库事项id进行关联得到宽表数据，详细规则如下：

```html
按照"受理平台"和"省一体化"分类，分别对"办件数据信息表"进行计算，其中， "省一体化"分类的办件数据需要保证"省办件编码"为空并且事项类型为特定范围。
```

```html
"办件数据信息表"和"实施清单最新明细表"、"实施清单历史明细表"进行关联取后两者的维度信息值，包括部门信息和区划信息，得到办件信息明细表宽表。
```

###### 开发

创建开发治理任务，按照数据模型开发，开发中使用一个自定义函数实现年月日时分秒到年月日的转换新增一列。

###### 调度

完成开发后，任务按照业务和开发逻辑添加依赖和调度策略，提交发布任务。

###### 运维监控

任务及调度发布上线后可以进行所有任务的运维监控，如任务的启停、实例的重跑等操作。

###### 数据质量

定义质量规则、生成检查任务、产出质量报告，如：监控宽表数据质量，如：主键、空值率、区划编码合规率、未办结数波动率等。

###### 元数据

元数据采集和管理维护。

###### 数据标签

定义标签，如：全程网办、办件主题等。

###### 数据指标

定义指标，如：超时办结率、网办率等。

###### 数据资产

数据资产目录管理及资产编制。

###### 数据安全

分类分级、加密脱敏、权限管控。

##### 2.评价规则

各指标符合大屏指标要求，数据及时更新，计算结果和源端数据一致，功能使用便捷，系统操作简单为优；能实现需求，功能衔接不紧密评为良；不能实现需求评为差。

#### 排叫号系统指标API接口生成、API接口数据抽取入库

##### 1.需求描述

生成名为排叫号统计API的接口。将排叫号统计结果表生成API接口，接口入参包含统计日期起始值（必选）、统计日期结束值（必选）、区县（可选）； 接口返回参数包括统计日期、排号数、叫号数、平均等候时间、区县、街道、政务中心。对API进行调用权限管理。通过API管理页面查看本API调用次数、平均响应时长、失败次数、上下行流量等统计信息。

调用排叫号统计结果API接口，将接口返回数据存入中台ODS层进行存储。

###### 创建API

从库表选取排叫号统计结果表，选取统计日期映射出统计日期起始值和统计日期结束值两个参数，并作为必选参数，选取区县字段作为可选参数，生成API接口、对API进行调试，调试通过后保存接口入参实例和返回参数示例，同时生成API接口文档。

###### 权限管控

创建一个数据中台应用调用方，并授予排叫号统计API的调用权限。

###### 服务调用

- API数据源注册: 将排叫号统计API注册为一个数据源。

- API采集任务配置：

```html
配置API采集任务，命名为 “每日采集排叫号统计API”

API入参，其中$YYYYMMDD表示调用日期对应的日期参数：
{
	"统计日期起始值":"$YYYYMMDD",
	"统计日期结束值":"$YYYYMMDD",
	"区县":"高新区"
}			

配置API采集调度，设置为每5分钟调度一次。
```

###### 计量

对排叫号统计API计量统计。

##### 2.评价规则

能实现需求且功能衔接流畅、使用便捷评为优；能实现需求，功能衔接不紧密评为良；不能实现需求评为差。

#### 性能压测场景（稳定性、健壮性）（可选）

##### 1.需求描述

为了满足数据中台整体运行性能相关指标的要求，需从系统稳定性、健壮性和扩展性等方面进行整体考察，因此结合场景二的实际情况，从数据采集、任务调度、数据服务三个方面构造场景，对系统进行性能指标统计，具体步骤如下：

- 构建10个同类业务库。

- 复制15份场景二中的3张业务表到这10个业务库，针对这450张业务表同时执行数据采集（全量、增量）任务。

- 对采集的数据进行数据开发治理工作，即重复场景二的开发治理流程。

- 设置任务调度策略为并发执行。

- 监控执行的状态，记录执行的结果和具体耗时。

- 任务持续执行48小时。

- 调度过程中构造节点异常情况（如：调度节点异常、源业务库异常、目标库异常），查看调度执行情况。

- 构造基于库表生成的数据服务API接口，测试并发调用场景，统计并发量和响应耗时。

##### 2.评价规则

压力测试过程中稳定正常运行，系统无故障、无延迟、无报错，业务逻辑计算结果全部正确，API接口并发高，响应时间短为优；能实现需求，系统有部分报错，触发故障转移等机制，但业务逻辑计算结果大部分正确，API接口可以响应为良；不能实现需求，系统在测试过程中崩溃不可用评为差。

### 相关文档评估（可选）

为了更加便捷的了解数据中台相关的设计思路和实现方式，需各厂商提供相关的开发文档以供参阅。

#### 1.需求描述

开发设计文档：

- 产品开发规范文档

- 提供编程语言、技术栈、框架等说明文档

- 概要设计文档（含业务架构/系统架构/技术选型等等）

- 详细设计文档（核心功能的时序图）

- 系统部署文档

用户手册：

- 用户操作手册文档

#### 2.评判建议

- 产品开发全流程的相关文档是否完整；

- 架构设计、技术选型是否通用，是否满足后期的规划要求；

- 文档内容：领域模型设计、数据库模型设计和业务流程时序图等是否清晰，比如：元数据模型的设计、任务调度节点依赖逻辑的处理等；

- 业务处理逻辑是否清晰合理；

- 系统部署维护是否简单稳定。

### 功能加分项（可选）

该部分功能属于额外的数据中台非功能需求，非必需，如果能满足整体评价会适当提高。




### 总结和展望

### 参考

