---
layout:     post
title:      基于Dify的问数应用设计开发小结
subtitle:
date:       2025-08-11
author:     RC
header-img:
catalog: true
tags:
    - 大模型
    - Dify
    - 自然语言处理
---

### 背景

目前，各行各业随着大模型普及，都纷纷建立了各种智能问答、智能客服、知识检索等应用，通过知识库检索、Agent化等方法，实现了**与AI自然语言对话完成特定场景任务**的目标。

在数据分析方面，如果我们能够通过和大模型对话的形式，完成数据查询和统计分析，将极大的**降低使用门槛**，使非专业的技术人员、业务人员都能够**自主查询和分析数据**。

出于这个理念，经过近两个月的努力，我们也是通过Dify成功迭代出一个自然语言问数的应用，虽然还谈不上商业化价值，但过程中确实学到了很多东西。本文对此进行简单介绍。

### 难点在哪

难点就三个，**准不准？快不快？连续不连续？**

首先我们要明白自然语言问数的原理，其实就是NL2SQL，即**自然语言转换为SQL查询语句**，这一点是肯定的，因为海量的数据不可能全部"喂"给大模型，而传统的智能问答系统使用**知识库召回片段完成定向检索的模式**，在问数这个场景下，**效果也不好**（后面会提到），所以只能通过写SQL完成查询，进而分析，主要流程为（简化版本）：

![1](https://i.postimg.cc/y6Fg4kZd/image.png)

可能这个时候有人就会说了，这个简单，就是**直接把数据库的表结构喂给大模型，然后直接提问**就行了。

确实，对于一个业务场景比较简单的系统，其表结构单一，没有歧义，不会引起AI幻觉，那确实可以直接省略其他优化，很直白的用表结构投喂，准确率就达到了。但问题在于，复杂场景下，一个应用要负责查询多个领域/业务条线的数据，那么就**需要问题分类，就需要提示词工程、schema增强去压缩有用的信息，需要约束AI的生成结果，避免幻觉**等等，而为了解决“快”的问题，你又要考虑**简单问题的模式化处理，历史问题的复用**，为了解决“连续回答”的问题，你又要**引入记忆池，对用户意图进行检测**...总之，在问数的场景下，怎么**提升准确度和速度**都是没错的，这也是整个应用优化的方向。

> 很直观的一点就是，从最初的demo（能用）到最终版本（好用），Dify的编排节点从一开始的几个增加了几十个，更别提各个代码执行节点背后的程序支撑，复杂程度呈几何级升

> 很棒的一点是，在我们的场景下，Dify的产品设计已经能够满足（除了官方说后面修复的发布后预览网页模式下，部分全局变量不生效的bug），当然，字节的扣子听说也很不错，但还没时间尝试。

### 总结

### 参考


