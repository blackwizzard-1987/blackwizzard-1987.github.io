---
layout:     post
title:      åŸºäºDifyçš„é—®æ•°åº”ç”¨è®¾è®¡å¼€å‘å°ç»“
subtitle:
date:       2025-08-11
author:     RC
header-img:
catalog: true
tags:
    - å¤§æ¨¡å‹
    - Dify
    - è‡ªç„¶è¯­è¨€å¤„ç†
---


### èƒŒæ™¯

ç›®å‰ï¼Œå„è¡Œå„ä¸šéšç€å¤§æ¨¡å‹æ™®åŠï¼Œéƒ½çº·çº·å»ºç«‹äº†å„ç§æ™ºèƒ½é—®ç­”ã€æ™ºèƒ½å®¢æœã€çŸ¥è¯†æ£€ç´¢ç­‰åº”ç”¨ï¼Œé€šè¿‡çŸ¥è¯†åº“æ£€ç´¢ã€AgentåŒ–ç­‰æ–¹æ³•ï¼Œå®ç°äº†**ä¸AIè‡ªç„¶è¯­è¨€å¯¹è¯å®Œæˆç‰¹å®šåœºæ™¯ä»»åŠ¡**çš„ç›®æ ‡ã€‚

åœ¨æ•°æ®åˆ†ææ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡å’Œå¤§æ¨¡å‹å¯¹è¯çš„å½¢å¼ï¼Œå®Œæˆæ•°æ®æŸ¥è¯¢å’Œç»Ÿè®¡åˆ†æï¼Œå°†æå¤§çš„**é™ä½ä½¿ç”¨é—¨æ§›**ï¼Œä½¿éä¸“ä¸šçš„æŠ€æœ¯äººå‘˜ã€ä¸šåŠ¡äººå‘˜éƒ½èƒ½å¤Ÿ**è‡ªä¸»æŸ¥è¯¢å’Œåˆ†ææ•°æ®**ã€‚

å‡ºäºè¿™ä¸ªç†å¿µï¼Œç»è¿‡è¿‘ä¸¤ä¸ªæœˆçš„åŠªåŠ›ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡DifyæˆåŠŸè¿­ä»£å‡ºä¸€ä¸ªè‡ªç„¶è¯­è¨€é—®æ•°çš„åº”ç”¨ï¼Œè™½ç„¶è¿˜è°ˆä¸ä¸Šå•†ä¸šåŒ–ä»·å€¼ï¼Œä½†è¿‡ç¨‹ä¸­ç¡®å®å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚æœ¬æ–‡å¯¹æ­¤è¿›è¡Œç®€å•ä»‹ç»ã€‚

### éš¾ç‚¹åœ¨å“ª

éš¾ç‚¹å°±ä¸‰ä¸ªï¼Œ**å‡†ä¸å‡†ï¼Ÿå¿«ä¸å¿«ï¼Ÿè¿ç»­ä¸è¿ç»­ï¼Ÿ**

é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½è‡ªç„¶è¯­è¨€é—®æ•°çš„åŸç†ï¼Œå…¶å®å°±æ˜¯NL2SQLï¼Œå³**è‡ªç„¶è¯­è¨€è½¬æ¢ä¸ºSQLæŸ¥è¯¢è¯­å¥**ï¼Œè¿™ä¸€ç‚¹æ˜¯è‚¯å®šçš„ï¼Œå› ä¸ºæµ·é‡çš„æ•°æ®ä¸å¯èƒ½å…¨éƒ¨"å–‚"ç»™å¤§æ¨¡å‹ï¼Œè€Œä¼ ç»Ÿçš„æ™ºèƒ½é—®ç­”ç³»ç»Ÿä½¿ç”¨**çŸ¥è¯†åº“å¬å›ç‰‡æ®µå®Œæˆå®šå‘æ£€ç´¢çš„æ¨¡å¼**ï¼Œåœ¨é—®æ•°è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œ**æ•ˆæœä¹Ÿä¸å¥½**ï¼ˆåé¢ä¼šæåˆ°ï¼‰ï¼Œæ‰€ä»¥åªèƒ½é€šè¿‡å†™SQLå®ŒæˆæŸ¥è¯¢ï¼Œè¿›è€Œåˆ†æï¼Œä¸»è¦æµç¨‹ä¸ºï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰ï¼š

![1](https://i.postimg.cc/y6Fg4kZd/image.png)

å¯èƒ½è¿™ä¸ªæ—¶å€™æœ‰äººå°±ä¼šè¯´äº†ï¼Œè¿™ä¸ªç®€å•ï¼Œå°±æ˜¯**ç›´æ¥æŠŠæ•°æ®åº“çš„è¡¨ç»“æ„å–‚ç»™å¤§æ¨¡å‹ï¼Œç„¶åç›´æ¥æé—®**å°±è¡Œäº†ã€‚

ç¡®å®ï¼Œå¯¹äºä¸€ä¸ªä¸šåŠ¡åœºæ™¯æ¯”è¾ƒç®€å•çš„ç³»ç»Ÿï¼Œå…¶è¡¨ç»“æ„å•ä¸€ï¼Œæ²¡æœ‰æ­§ä¹‰ï¼Œä¸ä¼šå¼•èµ·AIå¹»è§‰ï¼Œé‚£ç¡®å®å¯ä»¥ç›´æ¥çœç•¥å…¶ä»–ä¼˜åŒ–ï¼Œå¾ˆç›´ç™½çš„ç”¨è¡¨ç»“æ„æŠ•å–‚ï¼Œå‡†ç¡®ç‡å°±è¾¾åˆ°äº†ã€‚ä½†é—®é¢˜åœ¨äºï¼Œå¤æ‚åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªåº”ç”¨è¦è´Ÿè´£æŸ¥è¯¢å¤šä¸ªé¢†åŸŸ/ä¸šåŠ¡æ¡çº¿çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±**éœ€è¦é—®é¢˜åˆ†ç±»ï¼Œå°±éœ€è¦æç¤ºè¯å·¥ç¨‹ã€schemaå¢å¼ºå»å‹ç¼©æœ‰ç”¨çš„ä¿¡æ¯ï¼Œéœ€è¦çº¦æŸAIçš„ç”Ÿæˆç»“æœï¼Œé¿å…å¹»è§‰**ç­‰ç­‰ï¼Œè€Œä¸ºäº†è§£å†³â€œå¿«â€çš„é—®é¢˜ï¼Œä½ åˆè¦è€ƒè™‘**ç®€å•é—®é¢˜çš„æ¨¡å¼åŒ–å¤„ç†ï¼Œå†å²é—®é¢˜çš„å¤ç”¨**ï¼Œä¸ºäº†è§£å†³â€œè¿ç»­å›ç­”â€çš„é—®é¢˜ï¼Œä½ åˆè¦**å¼•å…¥è®°å¿†æ± ï¼Œå¯¹ç”¨æˆ·æ„å›¾è¿›è¡Œæ£€æµ‹**...æ€»ä¹‹ï¼Œåœ¨é—®æ•°çš„åœºæ™¯ä¸‹ï¼Œæ€ä¹ˆ**æå‡å‡†ç¡®åº¦å’Œé€Ÿåº¦**éƒ½æ˜¯æ²¡é”™çš„ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªåº”ç”¨ä¼˜åŒ–çš„æ–¹å‘ã€‚

> å¾ˆç›´è§‚çš„ä¸€ç‚¹å°±æ˜¯ï¼Œä»æœ€åˆçš„demoï¼ˆèƒ½ç”¨ï¼‰åˆ°æœ€ç»ˆç‰ˆæœ¬ï¼ˆå¥½ç”¨ï¼‰ï¼ŒDifyçš„ç¼–æ’èŠ‚ç‚¹ä»ä¸€å¼€å§‹çš„å‡ ä¸ªå¢åŠ äº†å‡ åä¸ªï¼Œæ›´åˆ«æå„ä¸ªä»£ç æ‰§è¡ŒèŠ‚ç‚¹èƒŒåçš„ç¨‹åºæ”¯æ’‘ï¼Œå¤æ‚ç¨‹åº¦å‘ˆå‡ ä½•çº§å‡

> å¾ˆæ£’çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸‹ï¼ŒDifyçš„äº§å“è®¾è®¡å·²ç»èƒ½å¤Ÿæ»¡è¶³ï¼ˆé™¤äº†å®˜æ–¹è¯´åé¢ä¿®å¤çš„å‘å¸ƒåé¢„è§ˆç½‘é¡µæ¨¡å¼ä¸‹ï¼Œéƒ¨åˆ†å…¨å±€å˜é‡ä¸ç”Ÿæ•ˆçš„bugï¼‰ï¼Œå½“ç„¶ï¼Œå­—èŠ‚çš„æ‰£å­å¬è¯´ä¹Ÿå¾ˆä¸é”™ï¼Œä½†è¿˜æ²¡æ—¶é—´å°è¯•ã€‚

### æ¢ç´¢è¿‡ç¨‹

æ•´ä¸ªåº”ç”¨çš„æ¢ç´¢è¿‡ç¨‹ç§°å¾—ä¸Šæ˜¯æ‘¸ç€çŸ³å¤´è¿‡æ²³ï¼Œæ¯•ç«Ÿæ²¡æœ‰ç›¸å…³è®¾è®¡ç»éªŒï¼Œå¤§æ¨¡å‹ç›¸å…³çš„å¾ˆå¤šæ¦‚å¿µä¹Ÿæ˜¯ä¸€çŸ¥åŠè§£ï¼Œåªèƒ½ä¾é ç½‘ä¸Šèµ„æ–™å’Œå®˜ç½‘çš„æ–‡æ¡£ï¼ˆdeepseek APIæ–‡æ¡£å’ŒDifyäº§å“æ–‡æ¡£ï¼‰æ…¢æ…¢æ‘¸ç´¢ã€‚

åº”ç”¨ä¸­å¾ˆå¤šçš„èŠ‚ç‚¹çš„ç¨‹åºç¼–å†™ä»¥åŠæ¶æ„å’Œç»„ä»¶ï¼Œéƒ½æ˜¯å’Œå¤§æ¨¡å‹å¤šè½®å¯¹è¯æ…¢æ…¢æ·»åŠ çš„ï¼Œå¤–éƒ¨çš„éœ€æ±‚ã€æµ‹è¯•å’Œåé¦ˆä¸»è¦æ¥è‡ªäº§å“ç»ç†ï¼Œæ€»ä½“ç¬¦åˆæµ‹è¯•ï¼Œåé¦ˆï¼Œä¼˜åŒ–çš„æµç¨‹ï¼Œä¸»è¦åˆ†ä¸º3ä¸ªé˜¶æ®µï¼š

![1](https://i.postimg.cc/JzX2PrQr/xiang-mu-gui-hua.png)

#### èµ·æ­¥é˜¶æ®µï¼šå‡†ä¸å‡†

è¿™ä¸ªé˜¶æ®µä¸»è¦æ˜¯æ»¡è¶³é—®æ•°åº”ç”¨æœ€åŸºæœ¬ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„è¦æ±‚â€”â€”**èƒ½å¤Ÿå‡†ç¡®æ ¹æ®ç”¨æˆ·é—®é¢˜å›ç­”å¯¹åº”ç»Ÿè®¡æŒ‡æ ‡**ã€‚æ»¡è¶³åŸºæœ¬æ¡ä»¶åï¼Œåœ¨å®é™…åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘åº”ç”¨æ¶µç›–çš„**åœºæ™¯äº¤å‰**çš„é—®é¢˜ã€æœ€ç»ˆå›ç­”åçš„**ç”¨æˆ·å¼•å¯¼**ã€**å›¾å½¢ç”Ÿæˆè¦æ±‚**ç­‰ç­‰ã€‚

##### 1ã€é—®é¢˜åˆ†ç±»å™¨

é—®é¢˜åˆ†ç±»å™¨ä¸»è¦ä¿è¯äº†**åº”ç”¨æ¶µç›–çš„ä¸åŒåœºæ™¯ä¹‹é—´çš„éš”ç¦»æ€§**ï¼Œå› ä¸ºæ¯ä¸ªåœºæ™¯çš„æç¤ºè¯å’Œå…¶ä»–ç»„ä»¶éƒ½æ˜¯ä¸ç›¸åŒçš„ï¼ŒæŒ‰ç…§difyçš„workflowè®¾è®¡ï¼Œ**é—®é¢˜åˆ†ç±»è¿™ä¸ªç»„ä»¶**æ­é…åˆé€‚çš„æç¤ºè¯ï¼Œä½¿ç”¨ä¸€èˆ¬çš„LLMï¼ˆå¦‚qwen-3.32bå¿«é€Ÿæ¨¡å¼ï¼‰å³å¯æ¯”è¾ƒå‡†ç¡®çš„è¿›è¡Œåˆ†ç±»ï¼Œä¿è¯ç”¨æˆ·é—®é¢˜->åç»­æµç¨‹->åœºæ™¯ä¹‹é—´çš„é€‚é…ï¼ŒåŒæ—¶ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä¸€å¼€å§‹å°±**æ‹’ç»å›ç­”é€šç”¨æ€§ã€å¸¸è¯†æ€§æˆ–è€…éç»Ÿè®¡æ€§çš„ä¸ç›¸å¹²é—®é¢˜**ï¼ŒèŠ‚çº¦æ—¶é—´ã€‚

##### 2ã€æç¤ºè¯å·¥ç¨‹å’Œschemaå¢å¼ºæè¿°

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨LLMå¤„ç†ç”ŸæˆSQLèŠ‚ç‚¹çš„systemæç¤ºè¯ä¸­**æ˜ç¡®æ¨¡å‹çš„è§’è‰²å’Œä»»åŠ¡**ï¼Œå¹¶ä¸”ç»™å‡º**æ ¸å¿ƒåŸåˆ™**ï¼ˆæ¯”å¦‚æŒ‰ç…§è¦æ±‚ï¼Œå‚è€ƒè¡¨ç»“æ„å’Œç†è§£ç”¨æˆ·é—®é¢˜ï¼Œç”ŸæˆSQLï¼‰ï¼Œæ ¸å¿ƒåŸåˆ™ä¸å®œè¿‡å¤šï¼Œä¸»è¦æ˜¯å¸®åŠ©æ¨¡å‹ç†è§£ä»»åŠ¡ã€‚

æ¥ä¸‹æ¥ï¼Œè¡¨ç»“æ„å¯¹äºæ•´ä¸ªåº”ç”¨æ¥è¯´é‡è¦æ€§ä¸è¨€è€Œå–»ï¼Œæ€ä¹ˆè®©LLMæ›´å¥½çš„ç†è§£æ¯ä¸ªåœºæ™¯ä¸‹é¢æ¶‰åŠçš„è¡¨æ˜¯ä¸€ä¸ªå¾ˆåŸºç¡€ä½†åˆå¾ˆé‡è¦çš„é—®é¢˜ã€‚å› ä¸ºä¸€èˆ¬çš„å…³ç³»å‹æ•°æ®åº“çš„è¡¨ç»“æ„ï¼Œéƒ½æ˜¯**å¤§é‡ç¦»æ•£ä¿¡æ¯çš„æ•´åˆ**ï¼Œä¸é€‚ç”¨äºCoT(**Chain of Thoughts**)å½¢å¼çš„æ¡†æ¶ï¼Œä¹Ÿä¸é€‚åˆåˆ›é€ æ€§å†…å®¹ï¼Œ**å¯¹ç»“æœçš„å‡†ç¡®æ€§è¦æ±‚æé«˜**ï¼Œè¿™ä¹Ÿæ˜¯è‡ªç„¶è¯­è¨€é—®æ•°çš„ä¸€ä¸ªéš¾ç‚¹ã€‚

ç»è¿‡å°è¯•ï¼Œæˆ‘ä»¬æœ€ç»ˆä½¿ç”¨äº†**markdownæ ¼å¼**çš„æ”¹å†™ç‰ˆè¡¨ç»“æ„ä½œä¸ºLLMçš„æç¤ºè¯è¾“å…¥ï¼Œä¸»è¦åŒ…å«äº†**è¡¨åã€è¡¨æè¿°ã€å­—æ®µåã€å­—æ®µç±»å‹ã€å­—æ®µç©ºå€¼ä¸å¦ã€å­—æ®µæ³¨é‡Šã€å­—æ®µç¤ºä¾‹å€¼ã€ä¸»é”®å’Œä¸šåŠ¡ç”¨é€”**ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ¢³ç†è¡¨ç»“æ„åï¼Œéœ€è¦ç»“åˆå®é™…ä¸šåŠ¡ï¼Œå¯¹æŸäº›**æ­§ä¹‰æ€§è¡¨ç»“æ„å†…å®¹è¿›è¡Œçº¦æŸ**ï¼Œå¯¹è¯¥**åœºæ™¯ä¸‹é¢çš„é€šç”¨å†…å®¹è¿›è¡Œçº¦å®š**ï¼Œåœ¨ä¸€èˆ¬çš„åœºæ™¯ä¸­ï¼Œæ¶‰åŠ0-10å¼ è¡¨çš„è¡¨ç»“æ„ï¼Œæ¯å¼ è¡¨çº¦10-20å­—æ®µåŸºæœ¬æ²¡æœ‰å¤§çš„é—®é¢˜ã€‚åœ¨å…³è”è¡¨åœºæ™¯ä¸­ï¼Œéœ€è¦**è¿½åŠ å…³è”è¡¨ä¹‹é—´çš„å…³è”å…³ç³»æè¿°**ï¼ŒåŒ…å«å…³è”çš„è¡¨å’Œå…³è”çš„å­—æ®µä¿¡æ¯ã€‚

è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œ**åˆç†çš„è¡¨ç»“æ„è®¾è®¡**ï¼Œæˆ–è€…è¯´**è®¾è®¡ä¸“é—¨ç”¨äºLLMä½¿ç”¨çš„å®½è¡¨**ç­‰ï¼Œå¯¹äºLLMçš„ç†è§£å’Œé™å™ªï¼Œæé«˜å‡†ç¡®æ€§æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦**å¯¹LLMçš„è¾“å‡ºç»“æœè¿›è¡Œè§„èŒƒå¤„ç†**ï¼ŒåŒ…å«æˆ‘ä»¬æœŸæœ›è¾“å‡ºçš„å†…å®¹ï¼ˆå¦‚jsonæ ¼å¼çš„SQLå¯¹ï¼‰ï¼Œä»¥åŠä¸å¸Œæœ›æ¨¡å‹è¾“å‡ºçš„å†…å®¹ï¼ˆå¦‚ç¦æ­¢è¾“å‡ºå…¶ä»–å†…å®¹ï¼Œåªéœ€è¦SQLï¼‰ã€‚

å¦å¤–ï¼Œè¿˜éœ€è¦åœ¨æç¤ºè¯æœ«å°¾**ç»™å‡º1-2ä¸ªç”¨æˆ·é—®é¢˜å’Œå¯¹åº”SQLçš„ä¾‹å­ï¼ˆå³Few-Shotï¼‰**ï¼Œä¹Ÿå¯ä»¥æé«˜æ¨¡å‹è¾“å‡ºçš„å‡†ç¡®ç‡ã€‚

##### 3ã€å†³ç­–å¼•æ“å’Œå›¾å½¢ç”Ÿæˆ

å†³ç­–å¼•æ“æ˜¯é—®é¢˜åˆ†ç±»å™¨è¿›å…¥åˆ†æ”¯åçš„åˆä¸€ä¸ªåˆ†æ”¯èµ·ç‚¹ï¼Œä¸»è¦ç”¨äº**åˆ¤æ–­ç”¨æˆ·é—®é¢˜çš„ä¸¤ä¸ªç»´åº¦ï¼šæ¨¡ç³Šæ€§å’Œå¤æ‚æ€§**ï¼Œå¹¶æŒ‰ç…§è¯„ä¼°åˆ†æ•°è¿›å…¥ä¸åŒçš„åç»­åˆ†æ”¯å¤„ç†ã€‚æœ¬è´¨ä¸Šæ˜¯ä¸ºäº†å¢åŠ åº”ç”¨çš„æ³›ç”¨æ€§å’Œæ˜“ç”¨æ€§ã€‚é€šè¿‡å¯¹ç”¨æˆ·é—®é¢˜çš„ä¸¤ä¸ªç»´åº¦æ‰“åˆ†ï¼Œå¯ä»¥æ›´ç²¾ç»†åœ°å¤„ç†ä¸åŒç±»å‹é—®é¢˜ï¼Œåœ¨å‡†ç¡®åº¦å’Œæ•ˆç‡ä¸Šé¢éƒ½æœ‰æ‰€æé«˜ã€‚

å¯¹äºç”¨æˆ·çš„**æ¨¡ç³ŠæŸ¥è¯¢**ï¼Œæ¯”å¦‚ï¼šâ€œå¹¿å‘ŠæŠ•è¯‰â€ã€â€œå™ªéŸ³é—®é¢˜æŠ•è¯‰â€ã€â€œ6æœˆä»½ç¾¤ä¼—æŠ•è¯‰â€ç­‰ï¼Œè¿™äº›**é—®é¢˜æ²¡æœ‰ç‰¹åˆ«æ˜ç¡®çš„ä¸šåŠ¡ç»´åº¦æˆ–è€…æ—¶é—´å‘¨æœŸ**ï¼Œæ‰€ä»¥ï¼Œéœ€è¦LLMæ ¹æ®æˆ‘ä»¬çº¦å®šçš„æ—¶é—´ï¼Œä½œä¸ºç»Ÿè®¡å‘¨æœŸï¼Œç„¶åå°†ç›¸å…³å­—æ®µä½œä¸ºä¸šåŠ¡ç»´åº¦ï¼ŒæŸ¥è¯¢å‡ºæ‰€æœ‰çš„æ˜ç»†ä¿¡æ¯ï¼Œç„¶å**å°†è¿™äº›ä¿¡æ¯æ•´åˆèµ·æ¥å½¢æˆç»Ÿè®¡æ‘˜è¦ï¼Œæœ€ååé¦ˆç»™ç”¨æˆ·**ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯èƒ½å¤Ÿè®©ä¸å¤ªæ‡‚ä¸šåŠ¡æˆ–è€…åˆ†æçš„ç”¨æˆ·é—®é¢˜ä¹Ÿèƒ½å¤Ÿæ‰¾åˆ°ä»–ä»¬æƒ³äº†è§£çš„æ–¹å‘ï¼Œé€šè¿‡æ€»è§ˆ->å¼•å¯¼é—®é¢˜->å…·ä½“æŒ‡æ ‡çš„è·¯å¾„ï¼Œå®Œæˆä»–ä»¬çš„æ•°æ®åˆ†ææ¢ç´¢ã€‚

å¯¹äºç”¨æˆ·çš„**ç®€å•æŸ¥è¯¢**ï¼Œæ¯”å¦‚â€œæŒ‰ç±»åˆ«ç»Ÿè®¡æœ¬å­£åº¦ç¾¤ä¼—è¯‰æ±‚å‰åâ€ã€â€œå·¥å•å·23060003ç›®å‰çŠ¶æ€â€ã€â€œä¸Šæœˆç¾¤ä¼—è¯‰æ±‚ä¸­æŠ•è¯‰æ’åå‰äº”çš„éƒ¨é—¨â€ç­‰ï¼Œè¿™äº›é—®é¢˜çš„ä¸šåŠ¡ç»´åº¦éå¸¸æ˜æ˜¾ä¸”å›ºå®šï¼Œä¹ŸåŒ…å«äº†æ˜æ˜¾çš„ç­›é€‰æ¡ä»¶æˆ–è€…è®¡ç®—å£å¾„åŠç»Ÿè®¡å‘¨æœŸï¼Œå¯¹äºè¿™ç±»**æ¨¡å¼åŒ–çš„é—®é¢˜**ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥â€œæšä¸¾â€å¯èƒ½çš„å„ç§patternï¼Œç„¶åç›´æ¥ç”¨**ç¨‹åºç”ŸæˆSQL**ï¼Œæå¿«åˆå‡†ï¼Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯æ¯ä¸ªç”Ÿæˆå™¨éƒ½è¦å®šåˆ¶åŒ–å¼€å‘ï¼Œå¹¶ä¸”ä¸æ–­åœ°é€šè¿‡ä¸šåŠ¡åå“ºå®Œå–„ã€‚

å‰©ä¸‹æ¥çš„æœ€åä¸€ç±»**å¤æ‚é—®é¢˜**ï¼Œæ¯”å¦‚â€œæˆååŒºå†å²å·¥å•ä¸­ç¯å¢ƒå«ç”Ÿä¸å¸‚å®¹ç§©åºçš„æ•°é‡æ¯”å€¼ï¼Ÿâ€ã€â€œé¢„æµ‹ä¸‹ä¸ªå­£åº¦çš„æŠ•è¯‰è¶‹åŠ¿â€ã€â€œå¸‚æ°‘æœ€å…³å¿ƒçš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Œæœ‰å‡ ä¸ªï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆå†…å®¹ï¼Œå“ªä¸ªéƒ¨é—¨è´Ÿè´£çš„â€ã€â€œç”¨æŠ˜çº¿å›¾è¡¨ç¤º7æœˆä»¥æ¥çš„æŠ•è¯‰è¶‹åŠ¿â€ç­‰ï¼Œè¿™äº›é—®é¢˜è¦ä¹ˆæ¶‰åŠåˆ°äº†**è¾ƒå¤æ‚çš„ç»Ÿè®¡å£å¾„**ï¼Œæ¯”å¦‚ç¯æ¯”ã€ç­‰æ¯”ã€æ¯”å€¼ï¼Œæˆ–è€…æ˜¯**é¢„æµ‹**ç±»å‹ï¼Œæˆ–è€…æ˜¯**å¤šä¸ªé—®é¢˜ç»„åˆ**ï¼Œæˆ–è€…æ˜¯**æœ‰å›¾å½¢ç”Ÿæˆè¦æ±‚**ç­‰ç­‰ï¼Œæˆ‘ä»¬éƒ½å°†ä»–ä»¬åˆ’ä¸ºå¤æ‚é—®é¢˜ï¼Œå¿…é¡»å€ŸåŠ©LLMç”ŸæˆSQLã€‚è¿™é‡ŒLLMçš„SQLå‡†ç¡®åº¦å¾ˆä¾èµ–ä¸ç¬¬äºŒä¸ªæ­¥éª¤ä¸­æç¤ºè¯å·¥ç¨‹çš„æ•ˆæœï¼Œæˆ‘ä»¬ä¹Ÿä¼šå‘ç°å³ä½¿temperatureè®¾ç½®ä¸º0ï¼Œæ¨¡å‹ä¾ç„¶ä¼šå¶å°”å†™é”™SQLï¼ˆè¿™é‡Œéœ€è¦ç”¨**SQLæ ¡éªŒå™¨æ ¡éªŒè¯­æ³•é”™è¯¯**ï¼Œé¿å…ä¸€éƒ¨åˆ†é—®é¢˜ï¼Œ**AIå¹»è§‰ä¾ç„¶ä¸å¯é¿å…**ï¼Œæ¯”å¦‚æ— ä¸­ç”Ÿæœ‰æŸä¸ªä¸å­˜åœ¨çš„å­—æ®µï¼‰ã€‚ä½†æ€»ä½“ä¸Šï¼Œ**LLMå¯¹äºå¤æ‚é—®é¢˜çš„å¤„ç†è¿˜æ˜¯è¶…ä¹æƒ³è±¡ï¼ŒåŸºæœ¬èƒ½å¤Ÿæ»¡è¶³ç”¨æˆ·éœ€æ±‚**ã€‚

å›¾å½¢ç”Ÿæˆè¦æ±‚æˆ‘ä»¬é€šè¿‡Few-Shotèƒ½å¤Ÿè½»æ¾è§£å†³ï¼Œåªè¦ç»™å‡ºä¸€æ®µ**æ ‡å‡†çš„Echarts Pythonä»£ç **ï¼Œæ¨¡å‹å°±ä¼šæ ¹æ®å®é™…å›¾å½¢è¦æ±‚ç”Ÿæˆå„ç§å›¾å½¢ï¼ŒåŒ…æ‹¬å¸¸è§çš„**æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ï¼Œä»¥åŠé›·è¾¾å›¾ã€æ¼æ–—å›¾**ç­‰ç­‰ï¼Œä¸éœ€è¦é€šè¿‡difyçš„Echartsæ’ä»¶è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œæšä¸¾+åˆ†æ”¯å¤ªéº»çƒ¦ï¼ˆè™½ç„¶ä¸€å¼€å§‹æˆ‘ä»¬å°±æ˜¯è¿™æ ·åšçš„ï¼‰ã€‚

é€šè¿‡å¯¹ç”¨æˆ·é—®é¢˜çš„ç»†åˆ†ï¼Œä¸åŒè·¯å¾„çš„åˆ†æ”¯æ¥å…·ä½“å¤„ç†ä¸åŒç±»å‹å’Œå¤æ‚åº¦çš„é—®é¢˜ï¼Œè™½ç„¶åº”ç”¨æ•´ä½“æ¡†æ¶æ›´åŠ å¤æ‚ï¼Œ**å‡å°‘äº†å¯ç§»æ¤æ€§**ï¼Œä½†**æ˜“ç”¨æ€§å’Œæ€§èƒ½ä¼šæé«˜å¾ˆå¤š**ï¼Œè¿˜æ˜¯æ¨èåšçš„ã€‚

è¿™é‡Œçš„å†³ç­–å¼•æ“ä¹Ÿæ¶‰åŠåˆ°äº†ç¬¬äºŒä¸ªç ”ç©¶é˜¶æ®µè§£å†³â€œå¿«ä¸å¿«â€œé—®é¢˜çš„åŠæ³•ï¼Œåé¢ä¼šç»§ç»­ä»‹ç»å¤„ç†ç®€å•é—®é¢˜çš„ç¨‹åºè§„åˆ™ç”Ÿæˆå™¨ã€‚

##### 4ã€ç”¨æˆ·å¼•å¯¼å’Œç»“æœç”Ÿæˆçº¦æŸ

è¿™ä¸ªéƒ¨åˆ†çš„è¾“å‡ºå†…å®¹å› ä¸ºç›´æ¥é¢å‘ç»ˆç«¯ç”¨æˆ·ï¼Œæ‰€ä»¥æ˜¯**çœ‹èµ·æ¥æœ€ç®€å•ä½†å®é™…ä¸Šæœ€éº»çƒ¦çš„**ï¼Œå› ä¸ºå§‹ç»ˆæ— æ³•ç»•å¼€AIå¹»è§‰ï¼Œä½†åˆå¸Œæœ›èƒ½å¤Ÿå€ŸåŠ©äºè¯­è¨€æ¨¡å‹çš„å‘é‡åŒ–åŒ¹é…èƒ½åŠ›å‘æŒ¥å®ƒçš„â€œåˆ›é€ æ€§â€ï¼Œæ‰€ä»¥æœ€ååªèƒ½è¿›è¡Œå¹³è¡¡å’Œå–èˆã€‚

###### ç­”éæ‰€é—®

**ç­”éæ‰€é—®æˆ–è€…èƒ¡è¯Œåº”è¯¥æ˜¯é—®æ•°åœºæ™¯ä¸­æœ€å¿Œè®³çš„è¾“å‡ºç»“æœ**ï¼Œå› ä¸ºä¸æ˜¯agentæ•´ä¸ªè°ƒç”¨å·¥å…·å’Œæ€è€ƒé“¾å®Œæˆçš„ä»»åŠ¡ï¼Œæœ€ååˆ†æèŠ‚ç‚¹çš„LLMåªä¼šæ‹¿åˆ°ç”¨æˆ·é—®é¢˜ã€ç¬¬ä¸€ä¸ªLLM/è§„åˆ™å¼•æ“ç­‰å†™çš„SQLï¼Œä»¥åŠSQLæŸ¥è¯¢ç»“æœ/æ‘˜è¦æ¥å›ç­”é—®é¢˜ã€‚

ä¸€ä¸ªå¾ˆå…¸å‹çš„é—®é¢˜å°±æ˜¯ï¼ŒSQLæ²¡æœ‰å†™å¯¹ï¼Œæ¯”å¦‚ç”¨æˆ·é—®çš„æ˜¯å¤„ç†æ—¶é—´å¹³å‡å¤©æ•°ï¼Œè€ŒSQLå†™çš„æ˜¯count(1)ï¼Œå¦‚æœä¸ç‰¹åˆ«è¯´æ˜ï¼Œ**æ¨¡å‹æå¤§æ¦‚ç‡ä¼šæŠŠè¿™ä¸ªcount(1)çš„ç»“æœä½œä¸ºå¤©æ•°è¿”å›**ã€‚ç”±äºç”¨æˆ·ä¸çŸ¥é“åå°æ•°æ®ï¼Œæ‰€ä»¥ä»»ä½•è¿™ç±»å¹»è§‰å°±ä¼šäº§ç”Ÿè¯¯å¯¼ï¼Œç”šè‡³æ˜¯**åœ¨ç”¨æˆ·è¿½é—®åå‡ºç°å‰åçŸ›ç›¾çš„æƒ…å†µ**ã€‚

æ›´éšè”½çš„æƒ…å†µæ˜¯å•ä¸€æ•°å­—çš„è¾“å‡ºï¼Œæœ¬æ¥æ˜¯xxç±»å‹çš„å·¥å•æœ‰å¤šå°‘æ¡ï¼Œæ¨¡å‹å¾ˆå®¹æ˜“è¾“å‡ºä¸ºxxç±»å‹çš„æ•°é‡ä¸ºå¤šå°‘æ¡ï¼Œå®¹æ˜“äº§ç”Ÿæœ‰å¤šå°‘ä¸ªç±»å‹çš„è¯¯è§£ã€‚

è¿™é‡Œå…¶å®å°±æ˜¯éœ€è¦å¯¹è¾“å‡ºèŠ‚ç‚¹çš„æ¨¡å‹ææ ¡éªŒSQLä¸ç”¨æˆ·è¯­ä¹‰æ˜¯å¦ä¸€è‡´çš„è¦æ±‚ï¼Œå³ï¼š

1ã€**ä¿è¯SQLæ˜¯æ­£ç¡®çš„ï¼Œå¦åˆ™ç›´æ¥å›ç­”äº‹å®ï¼ˆSQLé”™è¯¯çš„ç»“æœè§£è¯»ï¼‰ï¼Œä¸å¼ºè¡Œç»‘å®šé”™è¯¯ç»“æœåˆ°é—®é¢˜ä¸Š**ã€‚

2ã€**ç²¾ç¡®è§£è¯»ï¼Œä¿è¯å’ŒSQLå†…å®¹è¡¨è¾¾çš„æŒ‡æ ‡å«ä¹‰ä¸€è‡´ï¼Œä¸å«ç³Šä¸äº§ç”Ÿæ­§ä¹‰**ã€‚

3ã€**åœ¨1çš„åŸºç¡€ä¸Šï¼Œå¦‚å®å›ç­”å¹¶å‘ŠçŸ¥é—®é¢˜ï¼Œæ¯”å¦‚ç›®å‰æŸ¥è¯¢ç»“æœæ˜¯Aï¼ŒæœªåŒ…å«Bï¼ˆç”¨æˆ·é—®é¢˜ï¼‰çš„æ•°æ®**ã€‚

è¿™æ ·ï¼Œè‡³å°‘åœ¨è¾“å‡ºç»“æœæ–¹é¢ï¼Œæ¨¡å‹æ²¡æœ‰æ˜æ˜¾çš„å¹»è§‰å’Œæ­§ä¹‰äº§ç”Ÿï¼Œä¸ºå‰é¢å¯èƒ½äº§ç”Ÿçš„SQLé”™è¯¯é¢„ç•™äº†è§£é‡Šä½™åœ°ï¼Œä¹Ÿä¸ºåç»­ç”¨æˆ·è¿½é—®æä¾›äº†ç©ºé—´ã€‚

çº¦æŸä¾‹å­å¦‚ä¸‹ï¼š

```
### 1. **ä¸¥æ ¼åŒ¹é…éªŒè¯**ï¼š
   - æ¯”è¾ƒç”¨æˆ·é—®é¢˜{{#sys.query#}}ä¸æŸ¥è¯¢SQL{{#xx.result#}}çš„è¯­ä¹‰ä¸€è‡´æ€§
   - å½“å‡ºç°ä»¥ä¸‹æƒ…å†µæ—¶å¦‚å®å‘ŠçŸ¥æ— æ³•å›ç­”ï¼š
     * æŒ‡æ ‡ç±»å‹ä¸åŒ¹é…ï¼ˆå¦‚ç”¨æˆ·é—®å¹³å‡å€¼ï¼ŒSQLè¿”å›è®¡æ•°ï¼‰
     * ç»´åº¦ç¼ºå¤±ï¼ˆå¦‚ç”¨æˆ·é—®åˆ†ç±»æ’åï¼Œç»“æœæ— åˆ†ç±»å­—æ®µï¼‰
     * æ•°æ®èŒƒå›´ä¸ç¬¦ï¼ˆå¦‚ç”¨æˆ·é—®æŠ•è¯‰æ•°æ®ï¼Œç»“æœæ— æŠ•è¯‰è®°å½•ï¼‰
   - é”™è¯¯ç¤ºä¾‹çº æ­£ï¼š  
     âŒ ç”¨æˆ·é—®â€œå¹³å‡å¤„ç†å¤©æ•°æ˜¯å¤šå°‘ï¼Ÿâ€ â†’ SQLè¿”å›count(*) â†’ åº”ç­”ï¼šâ€œå¹³å‡å¤©æ•°ä¸º15å¤©â€ï¼ˆå¹»è§‰ï¼‰  
     âœ… æ­£ç¡®åº”ç­”ï¼šâ€œå½“å‰æŸ¥è¯¢è¿”å›çš„æ˜¯å·¥å•æ•°é‡ï¼ˆ15æ¡ï¼‰ï¼ŒæœªåŒ…å«å¤„ç†å¤©æ•°ä¿¡æ¯â€

- **è®¡æ•°ç»“æœæ˜ç¡®è¡¨è¿°**ï¼š
  - å½“SQLä½¿ç”¨`COUNT()`ä¸”ç»“æœåªæœ‰å•ä¸€æ•°å­—æ—¶ï¼š
    âœ… æ­£ç¡®è¡¨è¿°ï¼š"å…±æœ‰{æ•°å­—}æ¡å’¨è¯¢ç±»å‹çš„å·¥å•è®°å½•"  
    âœ… æ­£ç¡®è¡¨è¿°ï¼š"å’¨è¯¢ç±»å·¥å•æ€»è®¡{æ•°å­—}æ¡"  
    âŒ ç¦æ­¢è¡¨è¿°ï¼š"å’¨è¯¢ç±»å‹çš„æ•°é‡ä¸º{æ•°å­—}"ï¼ˆæ˜“è¯¯è§£ä¸ºç±»å‹æ•°é‡ï¼‰  
    âŒ ç¦æ­¢è¡¨è¿°ï¼š"æœ‰{æ•°å­—}ä¸ªå’¨è¯¢ç±»å‹"
  - å¿…é¡»åŒ…å«**è®°å½•ç±»å‹æ ‡è¯†**ï¼ˆå·¥å•/è¯‰æ±‚/æ¥ç”µä¿¡ï¼‰

- **æ’åºç±»ç»“æœè¡¨è¿°**
  - å½“ç”¨æˆ·é—®é¢˜æ¶‰åŠåˆ°æœ€å¤šã€æœ€å°‘ã€æœ€é«˜ã€æœ€ä½ç­‰æœ€xxé—®é¢˜æ—¶ï¼ŒæŸ¥è¯¢ç»“æœå¦‚æœæœ‰å¤šä¸ªï¼Œå°±å–å¹¶åˆ—ï¼ˆå¦‚æœ‰ï¼‰æœ€xxçš„ç»“æœã€‚

### 2. **ç»“æœå¤„ç†å¢å¼º**ï¼š
   - å½“ç»“æœä¸ºç©ºæ—¶æ˜ç¡®å‘ŠçŸ¥ï¼šâ€œæœªæŸ¥è¯¢åˆ°ç›¸å…³æ•°æ®â€
   - å½“ç»“æœä¸é—®é¢˜ç»´åº¦ä¸ç¬¦æ—¶ï¼šâ€œå½“å‰ç»“æœåŒ…å«[å­—æ®µA][å­—æ®µB]ï¼Œä½†æ‚¨çš„é—®é¢˜æ¶‰åŠ[ç»´åº¦C]â€

### 3.**ç”¨æˆ·å‹å¥½å¤„ç†**
  - âœ…è¾“å‡ºç»“æœåªéœ€è¦å›ç­”ç”¨æˆ·é—®é¢˜å’Œç”Ÿæˆå¼•å¯¼æ¨¡æ¿å†…å®¹ï¼Œä¸éœ€è¦å…¶ä»–å›å¤å†…å®¹ã€‚
  - âŒè¾“å‡ºç»“æœä¸è¦åŒ…å«ä»»ä½•æ ¹æ®SQLæŸ¥è¯¢ç»“æœã€æŸ¥è¯¢SQLçš„æè¿°ã€"å¼•å¯¼å†…å®¹"ã€â€œå›ç­”â€å­—æ ·ã€‚
```

###### èŠ‚å¤–ç”Ÿæ

ç›®å‰çš„å¤§è¯­è¨€æ¨¡å‹å¯¹è¯æ¡†åŸºæœ¬éƒ½ä¼šåœ¨å›ç­”ç”¨æˆ·é—®é¢˜åç»™å‡º3ä¸ªå·¦å³çš„å»¶ä¼¸é—®é¢˜ï¼Œç”¨æˆ·å¼•å¯¼ç”¨æˆ·ç»§ç»­æé—®ã€‚è¿™ä¸ªå¼•å¯¼é—®é¢˜çœ‹ä¼¼å¾ˆå¹³å¸¸ï¼Œå®é™…ä¸Šæ“ä½œèµ·æ¥å®¹æ˜“é—®é¢˜â€”â€”å³è¯¯å¯¼ç”¨æˆ·ï¼Œä¸»è¦æœ‰ä»¥ä¸‹è¡¨ç°ï¼š

1ã€å¼•å…¥ä¸å½“å‰çŸ¥è¯†åº“/è¡¨ç»“æ„æ— å…³çš„ä¸»é¢˜ï¼ˆå¦‚äººå£ã€é¢ç§¯ç­‰ä¸å­˜åœ¨çš„æŒ‡æ ‡ï¼‰ã€‚

2ã€å¼•å…¥å’Œä¹‹å‰é—®é¢˜å’Œæ ¸å¿ƒç»“æœå®Œå…¨æ— å…³çš„æ–°ä¸»é¢˜ï¼Œæ¯”å¦‚ç”¨æˆ·é—®Aåˆ†ç±»ï¼ŒæŸ¥è¯¢ç»“æœåŒ…å«äº†Aã€Bã€Cåˆ†ç±»ï¼Œä½†æ¨¡å‹é€šè¿‡çŸ¥è¯†åº“/è¡¨ç»“æ„æ¨æ–­å‡ºäº†Dåˆ†ç±»ä½œä¸ºå»¶ç”³é—®é¢˜ã€‚

3ã€å› æœæ€§é—®é¢˜ï¼Œå®¹æ˜“è„±ç¦»æ•°æ®åˆ†ææœ¬èº«ï¼Œè€Œå›åˆ°ä¸šåŠ¡åœºæ™¯ä¸­ã€‚

**è§„é¿ä»¥ä¸Šè¡¨ç°åªæ˜¯è®©æ¨¡å‹çš„æ–°é—®é¢˜ä¸å‡ºå¤§é—®é¢˜ï¼Œè€Œå¦‚æœç´§è´´åŸé—®é¢˜ï¼Œæˆ–è€…å¯¹é—®é¢˜è¿›è¡Œå»¶ä¼¸**ï¼Œè¿™ä¸ªç›®å‰æˆ‘ä»¬ä¹Ÿåªæ˜¯åˆæ­¥è¾¾åˆ°æ•ˆæœï¼Œå³**æ ¸å¿ƒäº‹å®çº¦æŸåçš„æ’åˆ—ç»„åˆ**ï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰æ¨¡å‹æ€ä¹ˆæå–ç”¨æˆ·æŸ¥è¯¢ç»“æœçš„æ ¸å¿ƒäº‹å®ï¼Œä»¥åŠæ€ä¹ˆâ€æ‹¼æ¥â€œå¥½å¼•å¯¼é—®é¢˜ï¼Œæ¡†å®šèŒƒå›´åï¼Œæ¨¡å‹æœ‰é™çš„å‘æŒ¥(t=0.1)**åŸºæœ¬ä¸ä¼šäº§ç”Ÿè„±ç¦»ä¸»é¢˜çš„é—®é¢˜ï¼Œæˆ–è€…æ¥ä¸‹æ¥éš¾ä»¥å›ç­”çš„é—®é¢˜**ï¼Œæç¤ºè¯ä¸¾ä¾‹å¦‚ä¸‹ï¼š

```
## å¼•å¯¼å†…å®¹æ¨¡æ¿

åŸºäºæˆ‘ä»¬åˆšåˆšè®¨è®ºçš„**`{ç”¨æˆ·é—®é¢˜å…³é”®è¯æç‚¼}`**ç›¸å…³å†…å®¹ï¼Œæ‚¨å¯èƒ½è¿˜æƒ³äº†è§£ï¼š

- æ ¹æ®ç”¨æˆ·é—®é¢˜ç”Ÿæˆçš„é—®é¢˜ä¸¾ä¾‹1
- æ ¹æ®ç”¨æˆ·é—®é¢˜ç”Ÿæˆçš„é—®é¢˜ä¸¾ä¾‹2
- æ ¹æ®ç”¨æˆ·é—®é¢˜ç”Ÿæˆçš„é—®é¢˜ä¸¾ä¾‹3

æˆ–è€…ç›´æ¥æå‡ºæ‚¨å…³å¿ƒçš„é—®é¢˜ï¼Œæˆ‘ä¼šä¸ºæ‚¨è¯¦ç»†è§£ç­”ï¼

### 2ã€ç”¨æˆ·å¼•å¯¼å†…å®¹ç”Ÿæˆè§„åˆ™ï¼ˆä¸¥æ ¼éµå¾ªï¼‰

**å¼•å¯¼é—®é¢˜å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶**ï¼š

1. **è¾“å…¥æºé™åˆ¶**ï¼š

- ä»…å…è®¸ä½¿ç”¨ï¼š
  âœ… ç”¨æˆ·åŸå§‹é—®é¢˜ï¼š`{{#sys.query#}}`
  âœ… SQLæŸ¥è¯¢ç»“æœä¸­çš„**æ ¸å¿ƒäº‹å®**ï¼ˆæœ€å¤š/æœ€å°‘/è¶‹åŠ¿ç­‰ç›´æ¥ç­”æ¡ˆï¼‰
- ç¦æ­¢ä½¿ç”¨ï¼š
  âŒ SQLä¸­LIMITè¿”å›çš„å…¶ä»–æ¬¡è¦ç»“æœé¡¹
  âŒ è¡¨ä¸­å­˜åœ¨ä½†æœªåœ¨ç”¨æˆ·é—®é¢˜æˆ–æ ¸å¿ƒç»“æœä¸­å‡ºç°çš„å­—æ®µ
  âŒ è¡¨ä¸­ä¸å­˜åœ¨çš„å­—æ®µ

2.**å…³é”®äº‹å®æå–æ–¹æ³•**:

- ä»SQLç»“æœè§£ææ ¸å¿ƒäº‹å®ï¼š
  æ’åºç±»æŸ¥è¯¢ï¼ˆORDER BY+LIMITï¼‰â†’ å–ç¬¬ä¸€æ¡ç»“æœ
  ç»Ÿè®¡ç±»æŸ¥è¯¢ï¼ˆCOUNT/SUMï¼‰â†’ å–æ•°å€¼æœ€å¤§çš„é¡¹
  è¶‹åŠ¿ç±»æŸ¥è¯¢ â†’ å–å˜åŒ–æœ€æ˜¾è‘—çš„é¡¹

3. **å››è¦ç´ ç»“æ„**ï¼š
   [æ—¶é—´èŒƒå›´] + [åŸå­æŒ‡æ ‡] + [ç»´åº¦æè¿°] + [å…³é”®è¯]
   
   åŸå­æŒ‡æ ‡ï¼šä»…é™è¡¨å­—æ®µï¼ˆldlx/blzt/ssqy/cgwthyxlç­‰ï¼‰
   å…³é”®è¯ï¼šç¾¤ä¼—è¯‰æ±‚/æ¥ç”µä¿¡/å·¥å•ä¸‰é€‰ä¸€
   ç»´åº¦æè¿°ï¼šä»…é™ssqy(åŒºåŸŸ)/blzt(çŠ¶æ€)/clqx(æ—¶æ•ˆ)ç­‰åŸºç¡€ç»´åº¦
   æ—¶é—´èŒƒå›´å¤„ç†ï¼š
   time_range = (
   æå–ç”¨æˆ·é—®é¢˜ä¸­çš„æ—¶é—´ or
   æå–SQLä¸­çš„WHEREæ—¶é—´æ¡ä»¶ or
   "æœ€è¿‘ä¸€æœˆ"  # é»˜è®¤)

4.**ä¸¥æ ¼ç¦æ­¢è¡Œä¸º**ï¼š

- ğŸš« ç¦æ­¢å¼•å…¥ç”¨æˆ·é—®é¢˜å’Œæ ¸å¿ƒç»“æœå‡æœªæåŠçš„æ–°ä¸»é¢˜ï¼ˆå¦‚SQLè¿”å›[äº•ç›–,å…¬å•,è¿å»º]ï¼Œä½†æ ¸å¿ƒç»“æœæ˜¯"äº•ç›–æœ€å¤š"ï¼Œåˆ™ç¦ç”¨å…¬å•/è¿å»ºï¼‰
- ğŸš« ç¦æ­¢ä½¿ç”¨è¡¨ä¸­å­˜åœ¨ä½†ä¸Šä¸‹æ–‡æœªå‡ºç°çš„å­—æ®µ
- ğŸš« ç¦æ­¢ç”Ÿæˆä¸å½“å‰æŸ¥è¯¢æ— å…³çš„é—®é¢˜
- ğŸš« ç¦æ­¢å¼•å…¥è¡¨ç»“æ„æœªæ¶‰åŠçš„æ–°ä¸»é¢˜ï¼ˆå¦‚äººå£ã€é¢ç§¯ç­‰ä¸å­˜åœ¨å­—æ®µï¼‰
- ğŸš« ç¦æ­¢ç”Ÿæˆéœ€è¦å…³è”è¡¨ä½†æœªæ¿€æ´»çš„é—®é¢˜ï¼ˆå¦‚æœªæŸ¥è¯¢è½¬åŠè¡¨æ—¶ï¼Œç¦æ­¢ç”Ÿæˆ"è½¬åŠåŸå› "ç±»é—®é¢˜ï¼‰
- ğŸš« ç¦æ­¢ç”Ÿæˆç»“æœä¸­ä¸å­˜åœ¨çš„ç»´åº¦ç»„åˆé—®é¢˜ï¼ˆå¦‚ç»“æœæ— bldwå­—æ®µæ—¶ï¼Œç¦æ­¢ç”Ÿæˆ"åŠç†å•ä½"ç±»é—®é¢˜ï¼‰
- ğŸš« ç¦æ­¢ç”Ÿæˆè¶…å‡ºå½“å‰æŸ¥è¯¢èŒƒå›´çš„æ¨æµ‹æ€§é—®é¢˜ï¼ˆå¦‚"ä¸ºä½•æ²¡æœ‰è®°å½•" â†’ æ”¹ä¸º"æ˜¯å¦æœ‰è®°å½•"ï¼‰
- ğŸš« ç¦æ­¢ä½¿ç”¨ä»»ä½•å› æœæ€§è¯æ±‡ï¼ˆ"ä¸ºä»€ä¹ˆ"ã€"åŸå› "ã€"ä¸ºä½•"ï¼‰
```

è¿™å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§ç”Ÿæˆçº¦æŸï¼Œè™½ç„¶ä¸ä¼šæ˜¾å¾—é‚£ä¹ˆâ€æ™ºèƒ½â€œï¼Œä½†è‡³å°‘ä¸ä¼šçŠ¯é”™ã€‚æ¯•ç«Ÿä¸€åƒä¸ªè¯»è€…æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ï¼Œç”¨æˆ·çœŸæ­£çš„è¯‰æ±‚å¾ˆéš¾æ£æ‘©ã€‚

#### ä¼˜åŒ–é˜¶æ®µï¼šå¿«ä¸å¿«

å¿«ä¸å¿«ç»å¯¹æ˜¯AIå¯¹è¯èŠå¤©æ—¶ç”¨æˆ·æœ€ç›´æ¥çš„æ„Ÿå—ï¼Œå¾ˆå¤šæ¨¡å‹åˆ†ä¸ºäº†æ·±åº¦æ€è€ƒå’Œå¿«é€Ÿæ¨¡å¼ï¼Œå¹¶ä¸”**æ·±åº¦æ€è€ƒæ¨¡å¼ä¸­é€šè¿‡æµå¼è¿”å›è¾“å‡º**ï¼ˆå³æ¨¡å‹çš„è¿”å›å†…å®¹è¿ç»­å‡ºç°ç›´è‡³è¾“å‡ºæ‰€æœ‰å†…å®¹ï¼Œè€Œä¸æ˜¯è½¬åœˆè½¬å¾ˆä¹…ç„¶åè¾“å‡ºæ‰€æœ‰å†…å®¹ï¼Œå¿«æ…¢å’Œæ¨¡å‹è¿”å›tokené€Ÿç‡æœ‰å…³ï¼‰ï¼Œæ·¡åŒ–è¿™ç§æ—¶é—´ä¸Šçš„â€œé•¿â€çš„æ„Ÿå—ã€‚

å¯¹æœ¬æ–‡ä¸­çš„AIå¤§æ¨¡å‹é—®æ•°åº”ç”¨è€Œè¨€ï¼Œç”±äºä¸æ˜¯agentæ“ä½œï¼Œç®€å•åˆ†å‡ºäº†â€œå†™SQLçš„LLMèŠ‚ç‚¹â€å’Œâ€œæœ€ç»ˆåˆ†æå¹¶è¾“å‡ºç»“æœçš„LLMèŠ‚ç‚¹â€è¿™ä¸¤ä¸ª**æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ˜¯å¿…é¡»è¦ä½¿ç”¨å¤§æ¨¡å‹çš„æ·±åº¦æ€è€ƒï¼ˆé•¿æ€è€ƒï¼‰æ¨¡å¼çš„**ï¼Œå¦åˆ™å‡†ç¡®æ€§ä¼šå¤§æ‰“æŠ˜æ‰£ï¼ˆç‰¹åˆ«æ˜¯å¯¹äºè¿½é—®çš„é—®é¢˜å’Œå¤æ‚é—®é¢˜çš„å¤„ç†ï¼‰ï¼Œå› æ­¤ï¼Œå¦‚ä½•æé«˜è¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„é€Ÿåº¦æˆä¸ºäº†æå‡å¿«ä¸å¿«æ•´ä½“æ„Ÿå—çš„å…³é”®ã€‚

##### è§„åˆ™ç”Ÿæˆå™¨

å¼•å…¥è§„åˆ™ç”Ÿæˆå™¨å°±æ˜¯ä¸ºäº†é…åˆä¸Šé¢æåˆ°çš„å†³ç­–å¼•æ“ï¼Œ**å°†ç”¨æˆ·çš„ç®€å•é—®é¢˜ç›´æ¥ç¨‹åºåŒ–å¤„ç†**ï¼Œä¸éœ€è¦å¤§æ¨¡å‹ä»‹å…¥ã€‚å…¶åŸç†ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯**æ¨¡å—åŒ–æ‹†è§£å’Œå¤„ç†ç”¨æˆ·é—®é¢˜ï¼Œç„¶åé€šè¿‡ä¸€å®šèŒƒå›´çš„æšä¸¾å®Œæˆè§£æå’Œæ˜ å°„**ã€‚

é€šè¿‡è®¾ç½®å›ºå®šçš„patternï¼Œç„¶åæ­£åˆ™ç­‰æ–¹å¼è§£æå‡ºç”¨æˆ·é—®é¢˜ä¸­çš„ç»´åº¦å…³é”®è¯ï¼Œæ˜ å°„ä¸ºè¡¨ä¸­çš„å­—æ®µåç§°ï¼Œæ›¿æ¢æ‰å›ºå®špatternä¸­çš„å˜é‡ï¼Œå°±æ‹¼æˆäº†å®Œæ•´çš„SQLã€‚

è¿™éƒ¨åˆ†çš„ç¨‹åºé…ç½®è§„åˆ™éœ€è¦åŒ…å«è¡¨ä¸­çš„å­—å…¸åå’Œç å€¼ï¼Œä»¥åŠä¸€äº›å¸¸ç”¨çš„ä¸šåŠ¡æœ¯è¯­ï¼Œæ¯”å¦‚å¦‚ä½•æå–è¡Œæ”¿åŒºåˆ’ï¼š

```
# ç®€åŒ–åŒºåŸŸæ˜ å°„é…ç½®
    "area_mapping": {
        "å…¨å¸‚": "",
        "ä¸­å¿ƒåŸåŒº": ["é”¦æ±ŸåŒº", "é’ç¾ŠåŒº", "é‡‘ç‰›åŒº", "æ­¦ä¾¯åŒº", "æˆååŒº"],
        "æˆååŒº": "æˆååŒº",
        "é”¦æ±ŸåŒº": "é”¦æ±ŸåŒº",
        "é’ç¾ŠåŒº": "é’ç¾ŠåŒº",
        "é‡‘ç‰›åŒº": "é‡‘ç‰›åŒº",
        "æ­¦ä¾¯åŒº": "æ­¦ä¾¯åŒº",
        "é«˜æ–°åŒº": "é«˜æ–°åŒº",
        "å¤©åºœæ–°åŒº": "å¤©åºœæ–°åŒº",
        "é¾™æ³‰é©¿åŒº": "é¾™æ³‰é©¿åŒº",
        "é’ç™½æ±ŸåŒº": "é’ç™½æ±ŸåŒº",
        "æ–°éƒ½åŒº": "æ–°éƒ½åŒº",
        "æ¸©æ±ŸåŒº": "æ¸©æ±ŸåŒº",
        "åŒæµåŒº": "åŒæµåŒº",
        "éƒ«éƒ½åŒº": "éƒ«éƒ½åŒº",
        "æ–°æ´¥åŒº": "æ–°æ´¥åŒº",
        "éƒ½æ±Ÿå °å¸‚": "éƒ½æ±Ÿå °å¸‚",
        "å½­å·å¸‚": "å½­å·å¸‚",
        "é‚›å´ƒå¸‚": "é‚›å´ƒå¸‚",
        "å´‡å·å¸‚": "å´‡å·å¸‚",
        "ç®€é˜³å¸‚": "ç®€é˜³å¸‚",
        "é‡‘å ‚å¿": "é‡‘å ‚å¿",
        "å¤§é‚‘å¿": "å¤§é‚‘å¿",
        "è’²æ±Ÿå¿": "è’²æ±Ÿå¿"
    },

def _extract_area_filter_simple(query: str) -> str:
    """æå–åŒºåŸŸè¿‡æ»¤æ¡ä»¶"""
    area_map = RULE_ENGINE_CONFIG["area_mapping"]
    
    # 1. ä¼˜å…ˆåŒ¹é…é…ç½®ä¸­çš„åŒºåŸŸåç§°ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
    for area_name, area_value in area_map.items():
        # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç¡®ä¿æ˜¯ç‹¬ç«‹è¯æˆ–å¸¦æ ‡ç‚¹çš„è¯
        pattern = r'(^|\s|,|ï¼Œ|ã€‚|ã€)' + re.escape(area_name) + r'($|\s|,|ï¼Œ|ã€‚|ã€)'
        if re.search(pattern, query):
            if area_name == "å…¨å¸‚":
                return ""
            if isinstance(area_value, list):
                areas = [f"'{a.strip()}'" for a in area_value]
                return f"ssqy IN ({', '.join(areas)})"
            elif area_value:
                return f"ssqy = '{area_value}'"
    
    # 2. å°è¯•åŒ¹é…"XXåŒº/å¿/å¸‚"æ ¼å¼çš„åŒºåŸŸåç§°
    if match := re.search(r"([\u4e00-\u9fa5]{2,4}(?:åŒº|å¿|å¸‚))", query):
        area_name = match.group(1)
        if area_name in area_map:
            area_value = area_map[area_name]
            if isinstance(area_value, list):
                areas = [f"'{a.strip()}'" for a in area_value]
                return f"ssqy IN ({', '.join(areas)})"
            elif area_value:
                return f"ssqy = '{area_value}'"
    
    # 3. æœ€åå°è¯•åŒ¹é…åŒºåŸŸåç§°ï¼ˆä½†è¦æ±‚è‡³å°‘åŒ…å«åŒº/å¿/å¸‚å­—æ ·ï¼Œé¿å…éƒ¨åˆ†åŒ¹é…ï¼‰
    area_names_with_suffix = [name for name in area_map.keys() if any(suffix in name for suffix in ["åŒº", "å¿", "å¸‚"])]
    for area_name in area_names_with_suffix:
        if area_name in query and area_name != "å…¨å¸‚":
            area_value = area_map[area_name]
            if isinstance(area_value, list):
                areas = [f"'{a.strip()}'" for a in area_value]
                return f"ssqy IN ({', '.join(areas)})"
            elif area_value:
                return f"ssqy = '{area_value}'"
    
    return ""
```

è¯¥èŠ‚ç‚¹çš„ç¨‹åºæµ‹è¯•ç”¨ä¾‹æ•ˆæœå¦‚ä¸‹ï¼š

![2](https://i.postimg.cc/9M3h368K/jue-ce-yin-qing-he-gui-ze-sheng-cheng-qi-ju-li-qu-hua.png)

å½“ç„¶ï¼Œè§„åˆ™ç”Ÿæˆå™¨ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå› ä¸ºæšä¸¾èŒƒå›´ä¸€å®šæ˜¯æœ‰é™çš„ï¼ˆæ—¶é—´ã€åœ°ç‚¹ç­‰ï¼‰ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œ**ç”¨æˆ·çš„é—®é¢˜è¶Šæ¨¡å¼åŒ–ï¼ˆå³ä¸šåŠ¡äººå‘˜ã€åˆ†æå¸ˆçš„â€œæœºæ¢°å¼â€æé—®ï¼‰ï¼Œè§„åˆ™ç”Ÿæˆå™¨å°±è¶Šæœ‰ç”¨**ï¼Œè€Œç”¨æˆ·é—®é¢˜è¶Šæ¨¡ç³Šã€è¶Šå¤æ‚ï¼Œè§„åˆ™ç”Ÿæˆå™¨å°±æ²¡æœ‰ä»€ä¹ˆä½œç”¨äº†ã€‚

ä½†åœ¨æé€Ÿè¿™ä¸ªæ€ä¹ˆå¹²éƒ½ä¸å«Œå¤šçš„é—®é¢˜ä¸Šé¢ï¼Œå¤šä¸€ä¸ªè·¯å¾„é€‰æ‹©ï¼Œè¿‡æ»¤æ‰éƒ¨åˆ†ç®€å•é—®é¢˜ï¼Œè®©LLMèŠ‚ç‚¹ä¸ä»‹å…¥ï¼Œæé«˜æ•´ä½“è¾“å‡ºé€Ÿåº¦ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„äº‹æƒ…ã€‚

##### å†å²é—®é¢˜åŒ¹é…åº“

##### ç®—åŠ›èµ„æºçš„æˆæœ¬

ç¦»çº¿ï¼šqwen3-32b
çº¿ä¸Šï¼šç«å±±å¼•æ“deepseek-v3

#### æ·±å…¥é˜¶æ®µï¼šè¿ç»­ä¸è¿ç»­

### å®é™…æ•ˆæœæ¦‚è§ˆ

### æ€»ç»“

### å‚è€ƒ


