---
layout:     post
title:      知识图谱绘制和ETL过程整理(上)
subtitle:
date:       2023-03-01
author:     RC
header-img:
catalog: true
tags:
    - 知识图谱
    - ER图
    - neo4j
    - 大数据
    - 政务服务
---

### 背景

“天府蓉易办”是属于成都市政务服务管理和网络理政办公室牵头下的品牌，是成都市以省一体化平台作为基础支撑，利用成都市大数据中心汇聚的数据资源，建设集“一网受理、协同办理、综合管理”于一体的在线政务服务品牌。

其中的“一件事服务”涵盖了多个个人和法人一件事服务，比如企业开办一件事、新生儿出生一件事等，涵盖户籍办理、社会保障、设立变更、就业创业等18个主题分类，通过联办事项和四川政务服务网对接，达到一次告知、一表申请、一口受理、一网审批、一窗发证、一体管理，实现数据多跑路，人少跑路的宗旨。

![1](https://i.postimg.cc/sx1HdMq7/1.png)

蓉易办的数据分析管理平台的事项库拥有绝大部分关于流程改造平台中一件事等相关的数据，根据公司领导的战略性要求，我们根据这部分数据从数据探查开始，按照上海市普陀区“政务服务一图通”的思路，以ER图为原型，通过Neo4j为载体，成功制作了一件事相关数据的知识图谱。

本文主要介绍项目初期的数据探查梳理工作和ER原型图的绘制。

### 数据探查和梳理工作

包括对流程改造平台事项库的所有库表的数据探查，找到它们的**数据关联关系**，为ER图绘制和平台人员对接业务流程做准备，主要工作：

- 53张表的表结构、字段字典、表注释、表行数、唯一标识梳理

- 对所有表的数据内容进行标注

- 对所有关联表的数据关联关系，关联字段梳理

该阶段是整个图谱的数据基座，需要尽可能的对库中的每张表都进行细致的梳理，梳理过程中也发现了很多问题：

- 省一体化改造平台的数据推送规则是保留所有历史版本，每次带上推送时间、批次号、删除标识和版本号，并同步/异步更新相关联的表中的数据，例如：

![2](https://i.postimg.cc/7Zbz3g7g/2.png)

```html
处理规则：
1.根据唯一标识分组按照cd_time倒序排序取最新一条数据使用
2.最新版本的记录标记为U(删除)的数据不处理，过滤掉
3.对于1规则下使用的数据在后续标签的建立时，带入三个属性（CdTime、CdBatch、CdOperation）表示数据推送情况
```

> 以上处理规则都基于流程改造平台本身会同步更新所有关联的表的数据，如果只更新部分表的数据，会导致头部表最新的数据无法和后续的关联表匹配联动

- 部分表的数据之间关联不明显，或者有重复的部分，比如主题表和一件事主题表中共有75个相同名字的主题，而这两张表对应的表的数据完全不同
```html
处理规则：
1.先将这些表作为独立部分分别和其对应的表关联处理，后续通过平台人员对接并确定业务流程和规则
```

- 部分表的数据可能存在两套逻辑，一套对应后台数据互相关联，一套对应业务逻辑用于使用，光从数据上无法理解或者理解起来有歧义，比如：
```html
为(后续沟通)整理后结果：
原始材料是标准材料的集合称呼，是一级材料
标准材料是原始材料的分解细化，是二级材料
二级材料的表格/表单/模板就是材料附件
一级材料对应事项，一级材料包含了二级材料，二级材料对应了办件

但实际上表中的数据一级和二级材料名字一致
```

```html
处理规则：
1.将问题数据整理汇总，等待与平台人员对接后确定业务流程和规则
```

- 同上，一些表的数据仅通过数据字典、数据聚合分类难以理解含义，需要结合业务的实际使用情况去理解，比如：
```html
主项、子项和办理项之间的关系？
为(后续沟通)整理后结果：
主项、子项等于办理项(存在没有子项的办理项=主项)
子项会有多个等于办理项，此时主项只是一个代号

一件事情形和精细化事项情形？
为(后续沟通)整理后结果：
先筛选办哪个不办哪个事项（N个里面选）（根据业务场景->主题的业态情形）
->再关联单个精细化事项的情形，满足哪个条件不满足哪个
->得到对应情形下的材料，进行提交
->最终获得办成一件事的所有材料

蓉易办的跳转、分发及深度对接？
为(后续沟通)整理后结果：
1.直接在蓉易办  
2.通过跳转（分发） --不存在业务数据
3.综合窗口统一受理（深度对接），推送部门 -- 存业务数据
```

> 由于平台人员只能口述回答问题，我们根据现场的回答提炼了主要内容，比较口语化，但不影响问题的定义和业务的规则、流程整理

```html
处理规则：
1.将问题数据整理汇总，等待与平台人员对接后确定业务流程和规则
```

- 事项的办理流程表中每个办理步骤都只与实施清单的编码相关联，即最小粒度为实施清单整体，因此无法通过这层关系去获取每个步骤需要的办理材料。
```html
处理规则：
1.更细的材料粒度需要业务部门的办件办理业务数据支撑，目前只能关联单个事项为单位的材料清单
```

- 附件材料表中包含大量分类为模板和样例的材料，材料名称以docx、doc、jpg、png、pdf、xlsx等28种后缀结尾，并提供了材料模板的下载地址，这对于梳理电子表单的标准字段而言难以借助不借助专业工具完成所有类型的文件标准字段梳理。
```html
处理规则：
1.将这块数据记为人工参与的大量工作量板块，共需要整理13394个不同名的附件文件的潜在标准字段作为电子表单的填充、规范使用
```

### ER图绘制

根据数据探查梳理出来的53张表清单和关联关系，以及通过了解业务流程和流程改造平台人员的答疑，我们将这些表大部分作为ER图的实体，以关联字段和部分重要字段作为实体的属性，建立他们之间的关系。

ER图的格式采用非最简化的图形形式，以矩形代表实体，椭圆表示实体的属性，菱形加文字表示实体之间的关系，以1、m、n来表示1对1，1对多，多对1，多对多的关系：

| 实体1 | m对n | 关系 | m对n | 实体2 |
| :--: | :--: | :--: | :--: | :--: |
| 人 | 1 | 持有 | 1 | 护照 |  
| 客户 | 1 | 购买 | n | 订单 |
| 学生 | m | 学习 | 1 | 学校 |  
| 学生 | m | 选课 | n | 课程 |

绘制时默认菱形的两个边，靠近实体的一个边为远离实体对于这个实体的关系：

![3](https://i.postimg.cc/Yq20zKVc/3.png)

如上图，学生和学校的关系是学习，学生对于学校来说有m个，学校对于学生来说只有1个，即学生->1->在学校学习, 学校->N->有N个学生学习。

> 对于更加详细的弱实体、多值，派生属性、弱关系、概化等概念，由于梳理和绘制较为繁琐，没有体现在ER图中，被省略，仅有关键属性作为关联字段（唯一标识）被标记出来

> 对于关系上的属性，因为基本围绕实体之间的属性，基本不使用该方式表示


### 小结

### 参考

[普陀区政务服务“一图通”](https://mp.weixin.qq.com/s/hFk66HvUKKZCG-H8eI-SkA)

